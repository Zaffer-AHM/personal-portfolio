<canvas id="topology-canvas" class="topology-canvas"></canvas>

<style>
  .topology-canvas {
    position: fixed;
    inset: 0;
    width: 100vw;
    height: 100vh;
    display: block;
    z-index: -10;
    pointer-events: none;
    background: #000000; /* black background */
  }
</style>

<script type="module">
  import { createNoise3D } from "https://cdn.jsdelivr.net/npm/simplex-noise@4.0.1/dist/esm/simplex-noise.js";

  const canvas = document.getElementById("topology-canvas");
  const ctx = canvas.getContext("2d");
  const noise3D = createNoise3D();

  let time = 0;
  let mouse = { x: -9999, y: -9999 };
  let size = { w: window.innerWidth, h: window.innerHeight };

  function resizeCanvas() {
    const dpr = window.devicePixelRatio || 1;
    size.w = window.innerWidth;
    size.h = window.innerHeight;
    canvas.width = size.w * dpr;
    canvas.height = size.h * dpr;
    canvas.style.width = size.w + "px";
    canvas.style.height = size.h + "px";
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  }
  resizeCanvas();

  function draw() {
    ctx.clearRect(0, 0, size.w, size.h);

    const lineGap = 60; // spacing between contour lines
    const lineCount = Math.ceil(size.h / lineGap) + 20;

    ctx.lineWidth = 0.2;
    ctx.strokeStyle = "#f5e6cc"; // cream topo lines
    ctx.shadowColor = "rgba(245, 230, 204, 0.5)";
    ctx.shadowBlur = 3;

    for (let i = 0; i < lineCount; i++) {
      const yBase = i * lineGap;
      ctx.beginPath();

      for (let x = 0; x <= size.w; x += 6) {
        const noiseVal = noise3D(x * 0.003, yBase * 0.01, time * 0.3);
        let y = yBase + noiseVal * 35;

        // Mouse distortion
        const dx = x - mouse.x;
        const dy = y - mouse.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        const influence = 400;
        if (dist < influence) {
          const strength = (1 - dist / influence) * 30;
          y += Math.sin(time * 0.5 + dist * 0.05) * strength;
        }

        if (x === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();
    }

    time += 0.01; // smooth animation
    requestAnimationFrame(draw);
  }

  window.addEventListener("resize", resizeCanvas);
  window.addEventListener("mousemove", (e) => {
    mouse.x = e.clientX;
    mouse.y = e.clientY;
  });
  window.addEventListener("mouseleave", () => {
    mouse.x = -9999;
    mouse.y = -9999;
  });

  draw();
</script>
